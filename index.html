<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleX - English Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background-color: #05070a; color: #ffffff; font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass-card { background: #11141b; border: 1px solid #1f242d; border-radius: 28px; }
        .tab-content { display: none; }
        .active { display: block; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .flashcard-inner { transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; position: relative; height: 250px; }
        .flashcard-inner.flipped { transform: rotateY(180deg); }
        .card-face { backface-visibility: hidden; position: absolute; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; border-radius: 28px; padding: 20px; text-align: center; }
        .card-back { transform: rotateY(180deg); background: #1e293b; border: 2px solid #3b82f6; }
    </style>
</head>
<body>

    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col p-5">
        
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-xl font-extrabold text-blue-500">SimpleX</h1>
                <p id="lvl-info" class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Level 1 ‚Ä¢ Beginner</p>
            </div>
            <div id="xp-counter" class="bg-blue-600/20 text-blue-400 px-4 py-1.5 rounded-full text-xs font-black">0 XP</div>
        </header>

        <main id="tab-learn" class="tab-content active">
            <div class="glass-card p-6 mb-4">
                <p class="text-gray-400 text-xs text-center mb-2 uppercase">–ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π:</p>
                <h2 id="task-text" class="text-xl font-semibold text-center mb-6">–Ø —É—á—É—Å—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</h2>
                <div id="build-zone" class="min-h-[60px] border-b border-gray-800 mb-6 flex flex-wrap justify-center gap-2 pb-4"></div>
                <div id="word-bank" class="flex flex-wrap justify-center gap-2"></div>
            </div>
            <button onclick="checkBuild()" class="w-full py-4 bg-blue-600 rounded-2xl font-bold shadow-lg shadow-blue-900/20">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
        </main>

        <main id="tab-cards" class="tab-content">
            <div class="perspective-1000">
                <div id="flashcard" class="flashcard-inner" onclick="this.classList.toggle('flipped')">
                    <div class="card-face glass-card text-3xl font-bold">Opportunity</div>
                    <div class="card-face card-back flex flex-col">
                        <span class="text-2xl font-bold">–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å</span>
                        <p class="text-sm text-blue-200 mt-4 italic">"This is a great opportunity for you"</p>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 mt-8">
                <button onclick="nextCard('easy')" class="flex-1 py-3 bg-green-600/20 text-green-400 border border-green-600/30 rounded-xl font-bold">–ó–Ω–∞—é</button>
                <button onclick="nextCard('hard')" class="flex-1 py-3 bg-red-600/20 text-red-400 border border-red-600/30 rounded-xl font-bold">–ó–∞–±—ã–ª</button>
            </div>
        </main>

        <main id="tab-chat" class="tab-content flex-1 flex flex-col h-[65vh]">
            <div id="chat-box" class="flex-1 overflow-y-auto space-y-4 mb-4 pr-1 scroll-smooth">
                <div class="glass-card p-4 rounded-tl-none max-w-[90%] text-sm">
                    –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π —É—á–∏—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ. –Ø –∑–Ω–∞—é, —á—Ç–æ —Ç–≤–æ–π —Ä–æ–¥–Ω–æ–π —è–∑—ã–∫ —Ä—É—Å—Å–∫–∏–π, –ø–æ—ç—Ç–æ–º—É –±—É–¥—É –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏. –û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?
                </div>
            </div>
            <div class="flex gap-2 mb-20">
                <input id="chat-input" type="text" placeholder="–ü–∏—à–∏ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏..." class="flex-1 bg-gray-900 border border-gray-800 rounded-2xl p-4 text-white outline-none focus:border-blue-500">
                <button onclick="sendMsg()" class="bg-blue-600 p-4 rounded-2xl font-bold">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                </button>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-black/80 backdrop-blur-md border-t border-gray-900 p-4 flex justify-around rounded-t-[35px]">
            <button onclick="switchTab('tab-learn')" class="flex flex-col items-center">
                <span class="text-xl">üß©</span>
                <span class="text-[9px] uppercase font-bold text-gray-500 mt-1">–ö–≤–∏–∑</span>
            </button>
            <button onclick="switchTab('tab-cards')" class="flex flex-col items-center">
                <span class="text-xl">üé¥</span>
                <span class="text-[9px] uppercase font-bold text-gray-500 mt-1">–ö–∞—Ä—Ç—ã</span>
            </button>
            <button onclick="switchTab('tab-chat')" class="flex flex-col items-center">
                <span class="text-xl">ü§ñ</span>
                <span class="text-[9px] uppercase font-bold text-gray-500 mt-1">–ß–∞—Ç</span>
            </button>
        </nav>
    </div>

    <script>
        let xp = parseInt(localStorage.getItem('sx_xp')) || 0;
        const token = "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";
        
        // –ö–ê–†–¢–û–ß–ö–ò
        const deck = [
            {en: "Curious", ru: "–õ—é–±–æ–ø—ã—Ç–Ω—ã–π", ex: "He is a curious student."},
            {en: "Improve", ru: "–£–ª—É—á—à–∞—Ç—å", ex: "I want to improve my English."},
            {en: "Decision", ru: "–†–µ—à–µ–Ω–∏–µ", ex: "It was a very difficult decision."}
        ];
        let cardIdx = 0;

        function nextCard(type) {
            if(type === 'easy') xp += 15;
            cardIdx = (cardIdx + 1) % deck.length;
            const card = document.getElementById('flashcard');
            card.classList.remove('flipped');
            setTimeout(() => {
                card.querySelector('.card-face:not(.card-back)').innerText = deck[cardIdx].en;
                card.querySelector('.card-back').innerHTML = `<span class="text-2xl font-bold">${deck[cardIdx].ru}</span><p class="text-sm text-blue-200 mt-4 italic">"${deck[cardIdx].ex}"</p>`;
                updateUI();
            }, 300);
        }

        // –ö–û–ù–°–¢–†–£–ö–¢–û–†
        const tasks = [{ru: "–Ø —É—á—É –∞–Ω–≥–ª–∏–π—Å–∫–∏–π", en: ["I", "learn", "English"]}];
        let userWords = [];

        function initBuild() {
            const task = tasks[0];
            document.getElementById('task-text').innerText = task.ru;
            const bank = document.getElementById('word-bank');
            bank.innerHTML = task.en.sort(() => Math.random()-0.5).map(w => `<button onclick="pick('${w}', this)" class="bg-gray-800 px-4 py-2 rounded-xl border border-gray-700 font-medium">${w}</button>`).join('');
            document.getElementById('build-zone').innerHTML = '';
            userWords = [];
        }

        function pick(w, btn) {
            userWords.push(w);
            btn.style.display = 'none';
            document.getElementById('build-zone').innerHTML += `<span class="bg-blue-600 px-3 py-1 rounded-lg m-1">${w}</span>`;
        }

        function checkBuild() {
            if(userWords.join(' ') === tasks[0].en.join(' ')) {
                alert("–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +20 XP");
                xp += 20;
                initBuild();
            } else {
                alert("–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑");
                initBuild();
            }
            updateUI();
        }

        // –ß–ê–¢ –° –ò–ò (Llama-3)
        async function sendMsg() {
            const input = document.getElementById('chat-input');
            const box = document.getElementById('chat-box');
            const val = input.value;
            if(!val) return;

            box.innerHTML += `<div class="bg-blue-600 p-4 rounded-2xl rounded-tr-none max-w-[90%] ml-auto text-sm shadow-lg">${val}</div>`;
            input.value = '';
            box.scrollTop = box.scrollHeight;

            const tempId = "t-"+Date.now();
            box.innerHTML += `<div id="${tempId}" class="glass-card p-4 rounded-tl-none max-w-[90%] text-sm italic text-gray-500 animate-pulse">–£—á–∏—Ç–µ–ª—å –¥—É–º–∞–µ—Ç...</div>`;

            try {
                const res = await fetch("https://api-inference.huggingface.co/models/meta-llama/Meta-Llama-3-8B-Instruct", {
                    headers: { Authorization: `Bearer ${token}` },
                    method: "POST",
                    body: JSON.stringify({ 
                        inputs: `<|begin_of_text|><|start_header_id|>system<|end_header_id|>You are a friendly English teacher for a Russian student. If the student makes a mistake, correct it. Explain in Russian if necessary, but keep the conversation in English.<|eot_id|><|start_header_id|>user<|end_header_id|>${val}<|eot_id|><|start_header_id|>assistant<|end_header_id|>`,
                        parameters: { max_new_tokens: 150, stop: ["<|eot_id|>"] }
                    }),
                });
                const data = await res.json();
                document.getElementById(tempId).remove();
                let reply = data[0].generated_text.split('assistant').pop().trim();
                box.innerHTML += `<div class="glass-card p-4 rounded-tl-none max-w-[90%] text-sm border-l-4 border-blue-500 shadow-xl">${reply}</div>`;
                xp += 10;
                updateUI();
            } catch(e) {
                document.getElementById(tempId).innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏. –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω!";
            }
            box.scrollTop = box.scrollHeight;
        }

        function updateUI() {
            document.getElementById('xp-counter').innerText = `${xp} XP`;
            document.getElementById('lvl-info').innerText = `Level ${Math.floor(xp/100)+1} ‚Ä¢ Beginner`;
            localStorage.setItem('sx_xp', xp);
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        initBuild();
        updateUI();
    </script>
</body>
</html>
