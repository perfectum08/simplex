<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleX Pro - Stats & AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
        body { background: #05070a; color: #f1f5f9; font-family: 'Plus Jakarta Sans', sans-serif; }
        .tab-content { display: none; }
        .active { display: block; }
        .glass { background: #11141b; border: 1px solid #1f242d; border-radius: 24px; }
        .btn-blue { background: #3b82f6; box-shadow: 0 10px 20px -10px rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body class="p-5 flex flex-col min-h-screen">

    <div class="flex justify-between items-center mb-8">
        <h1 class="text-xl font-extrabold tracking-tighter text-blue-500">SimpleX</h1>
        <div class="flex gap-4 text-[10px] font-bold uppercase tracking-widest text-gray-500">
            <div class="flex flex-col items-end"><span>–û—à–∏–±–æ–∫</span><span id="st-err-top" class="text-red-500 text-sm italic">0</span></div>
            <div class="flex flex-col items-end"><span>–°–ª–æ–≤</span><span id="st-words-top" class="text-green-500 text-sm italic">0</span></div>
        </div>
    </div>

    <div class="flex-1">
        <section id="tab-learn" class="tab-content active">
            <div class="glass p-6 mb-6">
                <p class="text-gray-500 text-[10px] uppercase font-bold mb-3 tracking-widest">–ü–µ—Ä–µ–≤–µ–¥–∏ —Ñ—Ä–∞–∑—É:</p>
                <h2 id="task-ru" class="text-lg font-bold mb-6 text-blue-50">...</h2>
                <div id="drop-zone" class="min-h-[50px] border-b border-gray-800 mb-8 flex flex-wrap gap-2 pb-3"></div>
                <div id="word-bank" class="flex flex-wrap gap-2"></div>
            </div>
            <button onclick="checkTask()" class="w-full py-4 btn-blue rounded-2xl font-bold active:scale-95 transition-all">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </section>

        <section id="tab-chat" class="tab-content flex flex-col h-[65vh]">
            <div id="ai-setup" class="mb-4 hidden">
                <input id="ai-token-input" type="password" placeholder="–í—Å—Ç–∞–≤—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω HF —Å—é–¥–∞..." class="w-full bg-gray-900 border border-gray-800 p-3 rounded-xl text-xs outline-none">
                <button onclick="saveToken()" class="mt-2 text-[10px] text-blue-500 uppercase font-bold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
            </div>
            <div id="chat-win" class="flex-1 overflow-y-auto space-y-4 mb-4 text-sm scroll-smooth pr-2"></div>
            <div class="flex gap-2 mb-20">
                <input id="chat-in" type="text" placeholder="–ù–∞–ø–∏—à–∏ —É—á–∏—Ç–µ–ª—é..." class="flex-1 bg-gray-900 border border-gray-800 rounded-2xl p-4 outline-none focus:border-blue-500">
                <button onclick="sendAI()" class="btn-blue px-6 rounded-2xl font-bold">></button>
            </div>
        </section>

        <section id="tab-stats" class="tab-content">
            <h2 class="text-xl font-bold mb-6 italic text-blue-500">Progress Report</h2>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="glass p-5"><p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Learned</p><p id="st-learned" class="text-2xl font-black">0</p></div>
                <div class="glass p-5"><p class="text-[10px] text-gray-500 uppercase font-bold mb-1 text-red-500">Mistakes</p><p id="st-errors" class="text-2xl font-black text-red-500">0</p></div>
            </div>
            <div class="glass p-5">
                <h3 class="text-xs font-bold mb-4 border-b border-gray-800 pb-2 uppercase text-gray-400">Journal (Last 5 errors):</h3>
                <div id="error-log" class="space-y-3 text-[11px]"></div>
            </div>
            <button onclick="localStorage.clear(); location.reload();" class="mt-10 text-[9px] text-red-900 uppercase font-bold tracking-widest">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
        </section>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-black/90 backdrop-blur-lg border-t border-gray-900 p-5 flex justify-around rounded-t-[40px]">
        <button onclick="switchTab('tab-learn')" class="opacity-50 hover:opacity-100 transition-opacity">üß©</button>
        <button onclick="switchTab('tab-chat')" class="opacity-50 hover:opacity-100 transition-opacity">ü§ñ</button>
        <button onclick="switchTab('tab-stats')" class="opacity-50 hover:opacity-100 transition-opacity">üìä</button>
    </nav>

    <script>
        let stats = JSON.parse(localStorage.getItem('simplex_v3_stats')) || { learned: [], errors: [], errorCount: 0 };
        let hfToken = localStorage.getItem('hf_user_token') || "";
        
        const db = {
            tasks: [
                {ru: "–Ø —É—á—É –∞–Ω–≥–ª–∏–π—Å–∫–∏–π", en: ["I", "learn", "English"]},
                {ru: "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", en: ["I", "like", "this", "app"]},
                {ru: "–¢—ã –º–æ–π —É—á–∏—Ç–µ–ª—å", en: ["You", "are", "my", "teacher"]}
            ]
        };

        let cur = 0;
        let build = [];

        function saveToken() {
            const val = document.getElementById('ai-token-input').value.trim();
            if(val) {
                localStorage.setItem('hf_user_token', val);
                hfToken = val;
                alert("–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ø–∞–º—è—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞!");
                document.getElementById('ai-setup').classList.add('hidden');
            }
        }

        function save() {
            localStorage.setItem('simplex_v3_stats', JSON.stringify(stats));
            document.getElementById('st-err-top').innerText = stats.errorCount;
            document.getElementById('st-words-top').innerText = stats.learned.length;
            document.getElementById('st-learned').innerText = stats.learned.length;
            document.getElementById('st-errors').innerText = stats.errorCount;
            const log = document.getElementById('error-log');
            log.innerHTML = stats.errors.slice(-5).reverse().map(e => `
                <div class="border-l-2 border-red-500 pl-3">
                    <div class="text-red-400 font-bold">–¢–≤–æ–π –æ—Ç–≤–µ—Ç: ${e.w}</div>
                    <div class="text-green-400">–í–µ—Ä–Ω–æ: ${e.c}</div>
                </div>
            `).join('');
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'tab-chat' && !hfToken) document.getElementById('ai-setup').classList.remove('hidden');
        }

        function initTask() {
            const t = db.tasks[cur];
            document.getElementById('task-ru').innerText = t.ru;
            const bank = document.getElementById('word-bank');
            bank.innerHTML = t.en.sort(() => Math.random() - 0.5).map(w => `<button onclick="pick('${w}', this)" class="bg-gray-800 px-4 py-2 rounded-xl border border-gray-700 font-bold">${w}</button>`).join('');
            document.getElementById('drop-zone').innerHTML = '';
            build = [];
        }

        function pick(w, btn) {
            build.push(w);
            btn.style.visibility = 'hidden';
            document.getElementById('drop-zone').innerHTML += `<span class="bg-blue-600/20 text-blue-400 px-3 py-1 rounded-lg border border-blue-500/30 m-1">${w}</span>`;
        }

        function checkTask() {
            const cor = db.tasks[cur].en.join(' ');
            const usr = build.join(' ');
            if (usr === cor) {
                if(!stats.learned.includes(cor)) stats.learned.push(cor);
                cur = (cur + 1) % db.tasks.length;
                initTask();
            } else {
                stats.errorCount++;
                stats.errors.push({w: usr || "–ø—É—Å—Ç–æ", c: cor});
                initTask();
            }
            save();
        }

        async function sendAI() {
            if(!hfToken) { alert("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω –≤–æ –≤–∫–ª–∞–¥–∫–µ —á–∞—Ç–∞!"); return; }
            const i = document.getElementById('chat-in');
            const w = document.getElementById('chat-win');
            if(!i.value) return;
            const msg = i.value;
            w.innerHTML += `<div class="bg-blue-600 p-4 rounded-3xl rounded-tr-none ml-auto max-w-[85%] text-white shadow-lg">${msg}</div>`;
            i.value = '';
            const tid = "t-"+Date.now();
            w.innerHTML += `<div id="${tid}" class="glass p-4 rounded-3xl rounded-tl-none mr-auto max-w-[85%] italic text-gray-500 animate-pulse text-xs">–£—á–∏—Ç–µ–ª—å –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Å–ª–æ–≤–∞...</div>`;
            w.scrollTop = w.scrollHeight;

            try {
                const r = await fetch("https://api-inference.huggingface.co/models/meta-llama/Meta-Llama-3-8B-Instruct", {
                    headers: { Authorization: "Bearer " + hfToken, "Content-Type": "application/json" },
                    method: "POST",
                    body: JSON.stringify({ inputs: `<|begin_of_text|><|start_header_id|>system<|end_header_id|>You are a helpful English teacher for Russian student. Answer in English, briefly. Explain in Russian if student makes a mistake.<|eot_id|><|start_header_id|>user<|end_header_id|>${msg}<|eot_id|><|start_header_id|>assistant<|end_header_id|>` }),
                });
                const d = await r.json();
                document.getElementById(tid).remove();
                let txt = d[0].generated_text.split('assistant').pop().replace('<|eot_id|>', '').trim();
                w.innerHTML += `<div class="glass p-4 rounded-3xl rounded-tl-none mr-auto max-w-[85%] border-l-4 border-blue-500 shadow-sm">${txt}</div>`;
            } catch(e) { 
                document.getElementById(tid).innerText = "–û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞. –ù–∞–∂–º–∏ 'üìä' –∏ —Å–±—Ä–æ—Å—å –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π."; 
            }
            w.scrollTop = w.scrollHeight;
        }

        initTask();
        save();
    </script>
</body>
</html>
